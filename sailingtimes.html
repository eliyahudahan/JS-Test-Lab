<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sailing Time Zones</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    h2, h3 { color: #0077b6; }
    p { font-size: 20px; font-weight: bold; }
    button { margin: 5px; padding: 8px; }
    input { padding: 5px; margin: 5px; }
  </style>
</head>
<body>
  <h1>Maritime Time Zone Viewer</h1>

  <h2>Live Time in Copenhagen</h2>
  <p id="clockCopenhagen"></p>

  <h3>Add Destination</h3>
  <input type="text" id="cityInput" list="city-list" placeholder="Enter port city">
  <datalist id="city-list"></datalist>
  <button onclick="addSailingClock()">Add Clock</button>

  <div id="sailingClocks"></div>
  <p id="message"></p>

  <script>
    // Define valid sailing regions with simplified bounding boxes
    const allowedRegions = [
      { name: "Copenhagen-Helsingborg", latMin: 55.5, latMax: 56.2, lonMin: 11.9, lonMax: 13.2, timeZone: "Europe/Copenhagen" },
      { name: "Copenhagen-Hamburg", latMin: 54.5, latMax: 56.0, lonMin: 8.9, lonMax: 10.5, timeZone: "Europe/Berlin" },
      { name: "Hamburg Area", latMin: 53.3, latMax: 54.0, lonMin: 9.7, lonMax: 10.5, timeZone: "Europe/Berlin" },
      { name: "Norwegian Coast (Expanded)", latMin: 57.9, latMax: 63.5, lonMin: 5.0, lonMax: 11.5, timeZone: "Europe/Oslo" },
      { name: "Faroe Islands", latMin: 61.3, latMax: 62.5, lonMin: -7.8, lonMax: -6.0, timeZone: "Atlantic/Faroe" },
      { name: "Iceland South to North", latMin: 63.4, latMax: 66.1, lonMin: -22.0, lonMax: -16.0, timeZone: "Atlantic/Reykjavik" }
    ];

    function getRegionForCoordinates(lat, lon) {
      return allowedRegions.find(region => lat >= region.latMin && lat <= region.latMax && lon >= region.lonMin && lon <= region.lonMax) || null;
    }

    async function getCoordinates(cityName) {
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(cityName)}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        return data.length ? { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon), display_name: data[0].display_name } : null;
      } catch (error) {
        console.error("Error fetching city:", error);
        return null;
      }
    }

    function updateCopenhagenClock() {
      document.getElementById("clockCopenhagen").innerHTML = new Date().toLocaleTimeString('da-DK', { timeZone: "Europe/Copenhagen" });
    }
    setInterval(updateCopenhagenClock, 1000);
    updateCopenhagenClock();

    async function addSailingClock() {
      const cityName = document.getElementById("cityInput").value.trim();
      const messageElement = document.getElementById("message");

      if (!cityName) return (messageElement.innerHTML = "❌ Please enter a city.");

      const coords = await getCoordinates(cityName);
      if (!coords) return (messageElement.innerHTML = "❌ City not found.");

      const region = getRegionForCoordinates(coords.lat, coords.lon);
      if (!region) return (messageElement.innerHTML = "❌ City is outside the sailing zone.");

      const clockId = cityName.replace(/\s/g, '').replace(/[^a-zA-Z0-9]/g, '');
      if (document.getElementById(clockId)) return (messageElement.innerHTML = "⚠️ Clock already added.");

      const clockDiv = document.createElement("div");
      clockDiv.innerHTML = `<h3>${coords.display_name}</h3><p id="${clockId}"></p><button onclick="removeClock('${clockId}')">Remove</button>`;
      document.getElementById("sailingClocks").appendChild(clockDiv);

      function updateClock() {
        document.getElementById(clockId).innerHTML = new Date().toLocaleTimeString('da-DK', { timeZone: region.timeZone });
      }

      setInterval(updateClock, 1000);
      updateClock();
      messageElement.innerHTML = "✅ Clock added successfully.";
    }

    function removeClock(clockId) {
      document.getElementById(clockId).parentElement.remove();
    }
  </script>
</body>
</html>