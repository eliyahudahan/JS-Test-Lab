<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>××¡×œ×•×œ×™ ×©×™×™×˜ ×¢× ×”×ª×¨××•×ª ××–×’ ××•×•×™×¨</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f8ff;
      direction: rtl;
    }
    button {
      background: #007acc;
      color: white;
      border: none;
      padding: 10px 15px;
      margin: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
    #route {
      margin-top: 20px;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .leg {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 5px;
      border-right: 5px solid #007acc;
    }
    .alert {
      padding: 8px;
      margin-top: 5px;
      border-radius: 4px;
      font-weight: bold;
    }
    .green { background: #e6f7e6; border-color: #2ecc71; }
    .yellow { background: #fff8e6; border-color: #f39c12; }
    .red { background: #fee; border-color: #e74c3c; }
    .distance-bar {
      height: 8px;
      background: #3498db;
      margin-top: 5px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>ğŸš¢ ××¡×œ×•×œ×™ ×©×™×™×˜ ××•××œ×¦×™×</h1>
  
  <div>
    <button onclick="startRoute(1)">××¡×œ×•×œ 1 (×¡×§× ×“×™× ×‘×™×” ××–×¨×—×™×ª)</button>
    <button onclick="startRoute(2)">××¡×œ×•×œ 2 (×‘×œ×˜×™×ª ××¢×¨×‘×™×ª)</button>
    <button onclick="startRoute(3)">××¡×œ×•×œ 3 (×‘×œ×˜×™×ª ××œ××”)</button>
  </div>
  
  <div id="weather-info" style="margin: 15px 0; padding: 10px; background: #eaf2f8; border-radius: 5px;">
    ××–×’ ××•×•×™×¨ ××¢×•×“×›×Ÿ: <span id="update-time">×˜×•×¢×Ÿ...</span>
  </div>
  
  <div id="route"></div>

  <script>
    // × ×ª×•× ×™ × ××œ×™× - ×§×•××•×¨×“×™× ×˜×•×ª ×•××¨×—×§×™×
    const ports = {
      "×¡×˜×•×§×”×•×œ×": { lat: 59.33, lon: 18.07, country: "×©×•×•×“×™×”" },
      "×•×™×¡×‘×™": { lat: 57.63, lon: 18.30, country: "×©×•×•×“×™×”" },
      "×¨×™×’×”": { lat: 56.97, lon: 24.00, country: "×œ×˜×‘×™×”" },
      "×§×œ×™×™×¤×“×”": { lat: 55.71, lon: 21.13, country: "×œ×™×˜×" },
      "×’×“× ×¡×§": { lat: 54.35, lon: 18.65, country: "×¤×•×œ×™×Ÿ" },
      "×•×•×¨× ××™× ×“×”": { lat: 54.18, lon: 12.09, country: "×’×¨×× ×™×”" },
      "×§×•×¤× ×”×’×Ÿ": { lat: 55.68, lon: 12.60, country: "×“× ××¨×§" },
      "×××œ×‘×•×¨×’": { lat: 57.05, lon: 9.92, country: "×“× ××¨×§" },
      "××•×¡×œ×•": { lat: 59.91, lon: 10.75, country: "× ×•×¨×‘×’×™×”" },
      "×˜×•×¨×§×•": { lat: 60.45, lon: 22.27, country: "×¤×™× ×œ× ×“" },
      "×”×œ×¡×™× ×§×™": { lat: 60.17, lon: 24.96, country: "×¤×™× ×œ× ×“" },
      "×˜××œ×™×Ÿ": { lat: 59.44, lon: 24.75, country: "××¡×˜×•× ×™×”" }
    };

    // ××¡×œ×•×œ×™× ××•××œ×¦×™×
    const routes = {
      1: ["×¡×˜×•×§×”×•×œ×", "×•×™×¡×‘×™", "×¨×™×’×”", "×§×œ×™×™×¤×“×”", "×’×“× ×¡×§", "×•×•×¨× ××™× ×“×”", "×§×•×¤× ×”×’×Ÿ"],
      2: ["×§×•×¤× ×”×’×Ÿ", "×××œ×‘×•×¨×’", "××•×¡×œ×•", "×˜×•×¨×§×•", "×”×œ×¡×™× ×§×™", "×˜××œ×™×Ÿ", "×¡×˜×•×§×”×•×œ×"],
      3: ["×¡×˜×•×§×”×•×œ×", "×”×œ×¡×™× ×§×™", "×˜×•×¨×§×•", "×˜××œ×™×Ÿ", "×¨×™×’×”", "×§×œ×™×™×¤×“×”", "×’×“× ×¡×§", "×§×•×¤× ×”×’×Ÿ"]
    };

    // ×”×’×“×¨×•×ª API - ×™×© ×œ×”×—×œ×™×£ ×‘××¤×ª×— ××™×©×™
    const apiKey = "YOUR_API_KEY_HERE"; // ×œ×”×—×œ×™×£ ×‘××¤×ª×— ××™×©×™ ×-OpenWeatherMap
    const weatherCache = {};

    // ×—×™×©×•×‘ ××¨×—×§ ×‘×™×Ÿ × ××œ×™×
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
        Math.sin(dLon/2) * Math.sin(dLon/2);
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    }

    // ×–××Ÿ ×¡×™××•×œ×¦×™×” ×œ×¤×™ ××¨×—×§
    function getSimulationTime(km) {
      return Math.max(3, Math.min(20, Math.floor(km / 50))); // 3-20 ×©× ×™×•×ª
    }

    // ×©×œ×™×¤×ª ××–×’ ××•×•×™×¨
    async function getWeather(city) {
      if (weatherCache[city]) return weatherCache[city];
      
      try {
        const response = await fetch(
          `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=he`
        );
        const data = await response.json();
        weatherCache[city] = data;
        return data;
      } catch (error) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª ××–×’ ××•×•×™×¨:", error);
        return null;
      }
    }

    // ×‘×“×™×§×ª ×”×ª×¨××•×ª
    function checkAlerts(weather) {
      if (!weather) return { level: "error", msg: "×œ× × ×™×ª×Ÿ ×œ×˜×¢×•×Ÿ × ×ª×•× ×™×" };
      
      const wind = weather.wind?.speed || 0;
      const temp = weather.main?.temp || 0;
      
      if (wind > 15 || temp < -5) {
        return { level: "red", msg: "âš ï¸ ×ª× ××™× ××¡×•×›× ×™×: " + 
               (wind > 15 ? `×¨×•×— ${wind} ××˜×¨/×©× ×™×™×” ` : "") + 
               (temp < -5 ? `×˜××¤×¨×˜×•×¨×” ${temp}Â°C` : "") };
      } else if (wind > 10 || temp < 0) {
        return { level: "yellow", msg: "âš ï¸ ×ª× ××™× ×××ª×’×¨×™×: " + 
               (wind > 10 ? `×¨×•×— ${wind} ××˜×¨/×©× ×™×™×” ` : "") + 
               (temp < 0 ? `×˜××¤×¨×˜×•×¨×” ${temp}Â°C` : "") };
      }
      
      return { level: "green", msg: "âœ… ×ª× ××™× ×˜×•×‘×™× ×œ×©×™×™×˜" };
    }

    // ×”×¨×¦×ª ××¡×œ×•×œ
    async function startRoute(routeNum) {
      const routeDiv = document.getElementById('route');
      routeDiv.innerHTML = `<h3>××¡×œ×•×œ ${routeNum}: ××ª×—×™×œ...</h3>`;
      
      const currentRoute = routes[routeNum];
      let totalDistance = 0;
      
      for (let i = 0; i < currentRoute.length - 1; i++) {
        const from = currentRoute[i];
        const to = currentRoute[i+1];
        const fromPort = ports[from];
        const toPort = ports[to];
        
        // ×—×™×©×•×‘ ××¨×—×§ ×•×–××Ÿ
        const distance = calculateDistance(
          fromPort.lat, fromPort.lon,
          toPort.lat, toPort.lon
        );
        totalDistance += distance;
        const simTime = getSimulationTime(distance);
        
        // ×˜×¢×™× ×ª ××–×’ ××•×•×™×¨
        const weather = await getWeather(to);
        const alert = checkAlerts(weather);
        const weatherDesc = weather?.weather?.[0]?.description || "×œ× ×™×“×•×¢";
        
        // ×”×¦×’×ª ××™×“×¢
        const legDiv = document.createElement('div');
        legDiv.className = `leg ${alert.level}`;
        legDiv.innerHTML = `
          <h4>${from} â†’ ${to}</h4>
          <div>××“×™× ×”: ${toPort.country}</div>
          <div>××¨×—×§: ${distance.toFixed(1)} ×§"×</div>
          <div>××–×’ ××•×•×™×¨: ${weatherDesc}</div>
          <div class="alert ${alert.level}">${alert.msg}</div>
          <div class="distance-bar" style="width: ${Math.min(100, distance)}%"></div>
        `;
        
        routeDiv.appendChild(legDiv);
        
        // ×¡×™××•×œ×¦×™×™×ª ×”××ª× ×”
        await new Promise(resolve => setTimeout(resolve, simTime * 1000));
      }
      
      routeDiv.innerHTML += `
        <div class="leg green">
          <h4>â­ ×”××¡×œ×•×œ ×”×•×©×œ×!</h4>
          <div>×¡×”"×› ××¨×—×§: ${totalDistance.toFixed(1)} ×§"×</div>
          <div>××¡×¤×¨ ×ª×—× ×•×ª: ${currentRoute.length}</div>
        </div>
      `;
      
      document.getElementById('update-time').textContent = new Date().toLocaleString('he-IL');
    }

    // ×”×¦×’×ª ×©×¢×ª ×¢×“×›×•×Ÿ
    document.getElementById('update-time').textContent = new Date().toLocaleString('he-IL');
  </script>
</body>
</html>